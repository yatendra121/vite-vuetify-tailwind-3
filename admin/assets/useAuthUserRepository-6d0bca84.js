import{a0 as e,p as t,a1 as a,a2 as s,r as o}from"./vendor-fcdf8aba.js";import{P as r}from"./index-a381323b.js";import{r as i}from"./index-8d523eaa.js";const n=r.getInstance(),l=n.getCookiePrefix(),c=l+"X-TOKEN",p=l+"X-REFRESH-TOKEN",f=(t,a,s)=>e.set(c,t,{expires:30,path:a}),u=(t,a,s)=>e.set(p,t,{expires:45,path:a}),E=()=>e.remove(c),d=()=>e.remove(p),m=r.getInstance(),h=t.CancelToken;t.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded";const T={baseURL:m.getApiBaseUrl()},y=t.create(T);y.defaults.headers.common["client-id"]=m.getClientId(),y.defaults.headers.common.Accept="application/json, text/plain, */*",y.interceptors.request.use((t=>{const a=e.get(c);return a&&(t.headers.Authorization="Bearer "+a),t.headers["device-id"]=e.get("DEVICE-ID"),t.headers["time-offset"]="test",t}),(e=>Promise.reject(e))),y.interceptors.response.use((e=>e.data),(e=>(e&&e.request&&401===e.request.status&&(E(),d()),Promise.reject(e))));var P=(e=>(e.CHANGE="CHANGE",e.UPDATE="UPDATE",e.MIX="MIX",e.DELETE="DELETE",e))(P||{});const g={state:{profile:null},mutations:{CHANGE(e,t){e.profile=t},UPDATE(e,t){},MIX(e,t){},DELETE(e,t){e.profile=t}},actions:{async CHANGE({commit:e},{data:t}){e("CHANGE",t)},async MIX({commit:e},{data:t}){e("MIX",t.data)},async DELETE({commit:e}){e("DELETE",null)}}},w=a({plugins:[s()],modules:{profile:g},getters:{authProfile:e=>e.profile?e.profile.profile:null,isAuth:e=>!(!e.profile||!e.profile.profile),permissions:e=>e.profile&&e.profile.profile&&e.profile.profile.permissions?e.profile.profile.permissions:[]}});function A(){const e=o(!1),t=async e=>{await w.dispatch(P.CHANGE,{key:P.CHANGE,data:e})},a=e=>{var t;t=e.data.token,n.getBaseUrl(),E(),d(),f(t.access_token,"/"),u(t.refresh_token,"/")};return{myProfile:async a=>await y.get(a,{cancelToken:new h((function(e){}))}).then((async e=>(await t(e.data.user),Promise.resolve(e.data)))).catch((async e=>Promise.reject(e.data))).finally((()=>{setTimeout((()=>{e.value=!0}),200)})),finished:e,loginUser:async(s,o)=>await y.post(s,o,{cancelToken:new h((function(e){}))}).then((async e=>(await t(e.data.user),a(e),new Promise((t=>{t(e.data)}))))).catch((e=>new Promise(((t,a)=>{a(e)})))).finally((()=>{setTimeout((()=>{e.value=!0}),100)})),logOutUser:async(t="",a="logout")=>{await y({url:a,method:"POST",data:{socketId:t}}).finally((()=>{setTimeout((()=>{e.value=!0}),0)})),E(),d(),await w.dispatch(P.DELETE,{key:P.DELETE}),i.push("/")},userProfileStore:t}}export{y as _,w as s,A as u};
